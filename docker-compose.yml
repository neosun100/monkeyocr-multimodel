version: '3.8'

services:
  # All-in-One service (Gradio UI + FastAPI)
  monkeyocr:
    image: neosun/monkeyocr-multimodel:1.0.0
    container_name: monkeyocr-multimodel
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - CUDA_VISIBLE_DEVICES=0
    ports:
      - "7860:7860"   # Gradio UI
      - "7870:7870"   # FastAPI
    volumes:
      - ./data:/tmp/monkeyocr
      - ./output:/app/MonkeyOCR/output
    restart: unless-stopped
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  # Gradio Demo only
  monkeyocr-demo:
    image: neosun/monkeyocr-multimodel:1.0.0
    container_name: monkeyocr-demo
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
    ports:
      - "7860:7860"
    volumes:
      - ./data:/tmp/monkeyocr
    command: ["demo"]
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]

  # FastAPI only
  monkeyocr-api:
    image: neosun/monkeyocr-multimodel:1.0.0
    container_name: monkeyocr-api
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
    ports:
      - "7870:7870"
    volumes:
      - ./data:/tmp/monkeyocr
      - ./output:/app/MonkeyOCR/output
    command: ["api"]
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
